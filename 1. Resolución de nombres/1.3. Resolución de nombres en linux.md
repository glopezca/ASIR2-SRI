# Configuración de Resolución de Nombres en Linux

La configuración de resolución de nombres en Linux puede involucrar varios archivos y servicios: **systemd-resolved**, **resolv.conf**, **netplan** y, opcionalmente, **NetworkManager**.  
A continuación se explica el propósito de cada uno y se presentan ejemplos de configuración.

---

## 1. Configuración en `/etc/systemd/resolved.conf`

Este archivo es el archivo de configuración principal de *systemd-resolved*, donde se definen opciones como servidores DNS, dominios de búsqueda y seguridad (DNSSEC).

```
# /etc/systemd/resolved.conf
[Resolve]
DNS=8.8.8.8 1.1.1.1            # Servidores DNS primarios (Google y Cloudflare)
FallbackDNS=8.8.4.4 1.0.0.1    # Servidores DNS de respaldo
Domains=example.com            # Dominio de búsqueda automático
DNSSEC=yes                      # Activar DNSSEC
Cache=yes                       # Habilitar caché de DNS
```

Para aplicar esta configuración, reinicia *systemd-resolved*:

```
sudo systemctl restart systemd-resolved
```

---

## 2. Configuración en `/etc/resolv.conf`

Este archivo es el estándar de configuración de DNS en Linux.  
Cuando *systemd-resolved* está activo, `/etc/resolv.conf` suele ser un enlace simbólico que apunta a `/run/systemd/resolve/stub-resolv.conf`.  

Ejemplo de `/run/systemd/resolve/stub-resolv.conf`:

```
# /run/systemd/resolve/stub-resolv.conf
nameserver 127.0.0.53          # IP de loopback de systemd-resolved
search example.com             # Dominio de búsqueda
```

Para asegurarte de que `/etc/resolv.conf` está enlazado correctamente:

```
sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
```

---

## 3. Configuración en `/etc/netplan/*.yaml`

El sistema *netplan* permite especificar servidores DNS y dominios de búsqueda por cada conexión de red.  

Ejemplo de configuración:

```
# /etc/netplan/01-netcfg.yaml
network:
  version: 2
  ethernets:
    eth0:
      dhcp4: no                        # Deshabilitar DHCP en esta interfaz
      addresses: [192.168.1.10/24]     # IP estática para eth0
      gateway4: 192.168.1.1            # Puerta de enlace
      nameservers:
        addresses:
          - 8.8.8.8                    # Servidores DNS
          - 1.1.1.1
        search:
          - example.com                # Dominios de búsqueda
          - localdomain
```

Para aplicar la configuración de *netplan*:

```
sudo netplan apply
```

---

## 4. Configuración en NetworkManager

Si el sistema usa *NetworkManager*, puedes configurar los servidores DNS en `/etc/NetworkManager/NetworkManager.conf`.  

Ejemplo:

```
# /etc/NetworkManager/NetworkManager.conf
[main]
dns=systemd-resolved              # Utiliza systemd-resolved

[connection]
id=My_Wired_Connection            # Nombre de la conexión
type=ethernet                     # Tipo de conexión
interface-name=eth0               # Interfaz de red

[ipv4]
method=manual                     # IP estática
addresses=192.168.1.10/24
gateway=192.168.1.1
dns=8.8.8.8;1.1.1.1               # Servidores DNS
dns-search=example.com;localdomain # Dominios de búsqueda
```

Para aplicar cambios en *NetworkManager*:

```
sudo systemctl restart NetworkManager
```

---

## Resumen de la Configuración

| Archivo de Configuración | Propósito | Ejemplo |
|--------------------------|-----------|---------|
| `/etc/systemd/resolved.conf` | Configura *systemd-resolved* | Servidores DNS, DNSSEC, caché |
| `/etc/resolv.conf` | Archivo estándar de DNS | Enlace a 127.0.0.53 con *systemd-resolved* |
| `/etc/netplan/*.yaml` | Configura red y DNS por interfaz | Servidores DNS y dominios de búsqueda |
| `/etc/NetworkManager/NetworkManager.conf` | Configura *NetworkManager* | `dns=systemd-resolved` |
