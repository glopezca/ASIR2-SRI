# Configuración de systemd-resolved

**systemd-resolved** es un servicio en sistemas Linux que forma parte de **systemd** y se encarga de la resolución de nombres de dominio (DNS). Esto incluye resolver nombres de dominio a direcciones IP y administrar el enrutamiento de consultas de DNS según la configuración de red.

---

## Funciones de systemd-resolved

- **Resolución de DNS**: Resuelve nombres de dominio (como *google.com*) a direcciones IP, utilizando servidores DNS configurados en el sistema.  
- **Soporte de DNS multi-cast y localización**: Puede manejar resoluciones de dominios `.local` usando el protocolo mDNS (Multicast DNS), permitiendo descubrir dispositivos en la misma red local sin un servidor DNS centralizado.  
- **DNSSEC**: Soporta DNSSEC (Domain Name System Security Extensions), un conjunto de extensiones de seguridad que aseguran que las respuestas de DNS sean auténticas y no manipuladas.  
- **Routing de consultas de DNS por interfaz**: Permite la configuración de servidores DNS específicos para cada interfaz de red (útil en sistemas con múltiples conexiones de red, como VPN).  
- **Caché de DNS**: Almacena en caché las respuestas de DNS, mejorando el rendimiento al reducir la cantidad de consultas de DNS realizadas a servidores externos.

---

## Configuración de systemd-resolved

Para configurar **systemd-resolved**, sigue estos pasos:

1. **Activar el servicio**  
   Asegúrate de que *systemd-resolved* esté activo y habilitado para iniciarse en el arranque:
   ```bash
   sudo systemctl enable systemd-resolved
   sudo systemctl start systemd-resolved
   ```

2. **Configurar el archivo `/etc/systemd/resolved.conf`**  
   Este archivo contiene las opciones principales de configuración de *systemd-resolved*. Puedes editarlo con tu editor preferido:
   ```bash
   sudo nano /etc/systemd/resolved.conf
   ```
   Las opciones principales que puedes configurar son:

   - **DNS=**: Especifica los servidores DNS.  
     Ejemplo:
     ```bash
     DNS=8.8.8.8 1.1.1.1
     ```
   - **FallbackDNS=**: Servidores DNS secundarios para usar si los principales no están disponibles.  
   - **Domains=**: Dominios de búsqueda que el sistema intenta resolver automáticamente.  
   - **DNSSEC=**: Activa o desactiva DNSSEC (`yes`, `no` o `allow-downgrade`).  
   - **Cache=**: Activa o desactiva la caché de DNS.  

   Guarda y cierra el archivo una vez que termines.

3. **Reiniciar systemd-resolved para aplicar los cambios**
   ```bash
   sudo systemctl restart systemd-resolved
   ```

4. **Configurar `/etc/resolv.conf` para apuntar a systemd-resolved**  
   Normalmente, *systemd-resolved* crea un enlace simbólico en `/etc/resolv.conf` que apunta a su propia configuración, en `/run/systemd/resolve/stub-resolv.conf`.  
   Asegúrate de que esté configurado correctamente:
   ```bash
   sudo ln -sf /run/systemd/resolve/stub-resolv.conf /etc/resolv.conf
   ```

5. **Verificar la configuración**  
   Para verificar que *systemd-resolved* está funcionando correctamente y ver los detalles de la resolución DNS, usa:
   ```bash
   systemd-resolve --status
   ```
   Este comando muestra los servidores DNS en uso y los dominios de búsqueda asignados a cada interfaz de red.

---

### Ejemplo básico de configuración de `/etc/systemd/resolved.conf`

```ini
[Resolve]
DNS=8.8.8.8 1.1.1.1
FallbackDNS=8.8.4.4 1.0.0.1
Domains=example.com
DNSSEC=yes
Cache=yes
```

Con esta configuración, *systemd-resolved* usará `8.8.8.8` y `1.1.1.1` como servidores DNS principales, y `8.8.4.4` y `1.0.0.1` como secundarios, y activará DNSSEC y la caché.
